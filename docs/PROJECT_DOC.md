
# 个人博客系统技术设计文档（React / Next.js 版本）

## 1. 文档目的

本文档用于说明个人博客系统的整体技术设计方案，明确系统架构、技术选型、核心模块、数据设计、缓存策略及部署方案，作为系统开发、实施和后续维护的技术依据。

---

## 2. 系统背景与目标

### 2.1 系统背景

随着个人内容创作和知识沉淀需求的增长，需要一个**可完全自主控制、支持用户互动、长期可演进**的博客系统。  
现有第三方博客平台在数据控制、定制能力和 AI 能力集成方面存在明显限制，因此需要设计并实现一套**完全自托管的独立博客系统**。

### 2.2 设计目标

* 支持个人博客内容发布与管理  
* 支持用户注册、登录与评论互动  
* 支持分类与标签体系  
* 支持图片、附件等对象存储  
* 保证系统安全性、可维护性和可扩展性  
* 架构清晰，避免过度设计  
* 媒体资源统一管理  
* 配置中心能力：
  * 邮件配置
  * OSS 服务配置
  * 博客基本信息配置
  * 网站头部 / 底部脚本配置
  * LLM（大模型）配置
* AI 文案润色：
  * 兼容 OpenAI API
  * 支持流式返回与前端实时渲染
* 评论回复与通知系统：
  * 所有评论通知管理员
  * 用户评论被回复时邮件通知
* 博客文章阅读量、评论量统计
* 全站阅读量 / 评论量统计
* 文件资源管理能力

---

## 3. 技术选型

### 3.1 前端技术栈

| 技术            | 选型                                                 |
| --------------- | ---------------------------------------------------- |
| 框架            | React 18 + Next.js（App Router）                     |
| 语言            | TypeScript                                           |
| UI 样式         | Tailwind CSS                                         |
| UI 组件库       | shadcn/ui                                            |
| 渲染模式        | SSR / SSG / ISR / RSC 混合模式                       |
| 状态管理        | React Context + Server Actions（必要时使用 Zustand） |
| Markdown 编辑器 | @uiw/react-md-editor / tiptap                        |
| HTTP 客户端     | fetch（Next.js 原生）                                |
| 权限控制        | Middleware + Server Components                       |

---

### 3.2 后端技术栈

* 语言：Python 3.11
* Web 框架：FastAPI
* ORM：SQLAlchemy 2.0（Async）
* 数据库驱动：asyncpg
* 认证方式：JWT（Access Token + Refresh Token）
* 数据迁移：Alembic
* 对象存储 SDK：boto3

---

### 3.3 数据与中间件

* 关系型数据库：PostgreSQL 15+
* 缓存系统：Redis
* 对象存储：Amazon S3
* Web 服务器 / 网关：Nginx

---

## 4. 系统整体架构

```

Browser
│
▼
Next.js Frontend
(SSR / RSC / SSG / SPA)
│  JWT
▼
FastAPI Backend
│
├── PostgreSQL（结构化数据）
├── Redis（缓存 / 验证码 / 限流）
└── Amazon S3（对象存储）

```

---

## 5. 系统角色与权限设计

### 5.1 角色定义

| 角色    | 描述               | 权限                                  |
| ------- | ------------------ | ------------------------------------- |
| ADMIN   | 系统管理员（唯一） | 发布 / 编辑文章，管理分类、评论、配置 |
| USER    | 注册用户           | 登录、发表评论                        |
| VISITOR | 访客               | 浏览文章                              |

### 5.2 权限原则

* 内容发布权限集中（单一管理员）
* 评论功能需要登录
* 不引入复杂 RBAC，仅基于角色判断
* 前端通过 Middleware + 后端 JWT 双重校验

---

## 6. 功能模块设计

### 6.1 博客文章模块

* 支持 Markdown 内容
* 草稿（DRAFT）/ 发布（PUBLISHED）状态
* SEO 友好 URL（slug）
* 支持文章封面图
* 支持 AI 文案润色（流式）

---

### 6.2 分类与标签模块

* 分类（Category）
  * 层级结构
  * 每篇文章仅属于一个分类
* 标签（Tag）
  * 多对多关系
  * 支持动态创建

---

### 6.3 用户与认证模块

* 邮箱注册 / 登录
* bcrypt 密码加密存储
* JWT 认证
* Access Token + Refresh Token
* Next.js Middleware 做前端访问拦截

---

### 6.4 评论模块

* 登录用户可评论
* 支持评论回复（树结构）
* 管理员可删除任意评论
* 评论触发邮件通知

---

### 6.5 文件与对象存储模块

* 博客封面图
* Markdown 内容图片
* 用户头像
* 后端统一生成 S3 上传凭证
* 前端直传 S3，减少后端压力

---

## 7. Redis 缓存设计（重点）

### 7.1 Redis 使用场景

1. 邮箱注册验证码  
2. 接口数据缓存  
3. 限流与安全控制（预留）  

---

### 7.2 邮箱注册验证码缓存

**Key：**

```

email:verify:{email}

```

**Value：**

```json
{
  "code": "123456",
  "type": "register"
}
```

* TTL：5 分钟
* 校验成功后立即删除

---

### 7.3 接口数据缓存

适用接口：

* 文章列表
* 文章详情
* 分类列表
* 标签列表

Key 示例：

```
post:list:page:{page}:size:{size}
post:detail:{slug}
category:list
tag:list
```

缓存策略：

* Cache Aside
* 写操作后主动删除缓存
* 允许短暂脏读

---

## 8. 数据存储设计

### 8.1 PostgreSQL 数据内容

* 用户账户
* 博客文章
* 分类、标签
* 评论数据

---

### 8.2 Amazon S3 存储结构

```
blog-assets/
 ├── cover/
 ├── post/
 └── avatar/
```

---

## 9. 系统部署设计

### 9.1 部署方式

* Docker + Docker Compose
* 单机部署即可满足需求

### 9.2 服务组成

* Next.js 前端服务
* FastAPI 后端服务
* PostgreSQL 数据库
* Redis 缓存
* Nginx 反向代理

---

## 10. 安全设计

* HTTPS
* JWT 认证
* 密码加密存储
* 接口访问鉴权
* 评论内容 XSS 过滤
* 注册 / 登录接口限流（基于 Redis）

---

## 11. 性能与可扩展性

* SSR / SSG / ISR 提升首屏速度与 SEO
* Redis 缓存热点数据
* 对象存储减轻数据库压力
* 模块化设计，便于扩展

---

## 12. 未来扩展方向

* 全文搜索 / 向量搜索
* AI 知识问答
* 知识图谱

---

## 13. 首次搭建引导流程

* 首次启动系统自动进入初始化配置页面
* 配置管理员账户
* 配置 OSS 服务
* 配置邮箱服务（可选）
* 配置 LLM 服务（可选）

---

## 14. 设计总结

本系统基于 React + Next.js + FastAPI 构建，遵循“简单、清晰、可演进”的设计原则，在满足个人博客核心需求的同时，为 AI 能力与未来功能扩展预留充足空间。

